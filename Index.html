<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    >
  <title>Bootstrap Modal Signup Form</title>
</head>

<body>

  <div class="container">
    <h2>User Details</h2>

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#signupModal">Create New User</button>
  
  </br>
</br>
  <table class="table" id="TableData">
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">FirstName</th>
        <th scope="col">LastName</th>
        <th scope="col">Gender</th>
        <th scope="col">Hobbies</th>
        <th scope="col">Current Address</th>
        <th scope="col">Email</th>
        <th scope="col"></th>
        <th scope="col"></th>
        
      </tr>
    </thead>    
  </table>  
</div>

<div class="modal" id="signupModal" tabindex="-1" role="dialog" aria-labelledby="signupModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">    
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" id="signupModalLabel">Create New User</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          <form >
            <div class="form-group">
                <label for="firstName"><h5>FirstName</h5></label>
                <input type="text" id="txtfname" class="form-control" placeholder="Enter FirstName" name="firstName" required>
                <span id="NameCheck" class="text-danger">The Firstname is Required....</span>
              </div>

              <div class="form-group">
                <label for="lastName"><h5>LastName</h5></label>
                <input type="text" id="txtlname" class="form-control" placeholder="Enter LastName" name="lastNamequired" required>
                <span id="LastNameCheck" class="text-danger">The Lastname is Required....</span>
              </div>

              <div class="form-group">
                <label for="gender"><h5>Gender</h5></label>
              </br>
                <!-- <input type="text" class="form-control" placeholder="Enter FirstName" name="firstName" required> -->
                <input type="radio" id="Male" name="gender" value="male" checked="checked"> Male
                <input type="radio" id="Female" name="gender" value="female"> Female
                <input type="radio" id="Other" value="Other" name="gender"> Other
              </div>
            
              <div class="form-group">
                <label for="hobbies"><h5>Hobbies</h5></label>
            </br>
                <input type="checkbox" name="hobbies" value="Painting"  checked="checked"> Painting
                <input type="checkbox" name="hobbies" value="Reading"> Reading
                <input type="checkbox" name="hobbies" value="Music"> Music
                <input type="checkbox" name="hobbies" value="Cooking"> Cooking
                <input type="checkbox" name="hobbies" value="Gardening"> Gardening
                <input type="checkbox" name="hobbies" value="Running"> Running
                <input type="checkbox" name="hobbies" value="Dance"> Dance
                <input type="checkbox" name="hobbies" value="Singning"> Singning
                <span id="HobbiesCheck" class="text-danger">Please Select atleast 2 Hobbies....</span>
            </div>
            <div class="form-group">
                    <label class="control-label">
                        Current Address :
                    </label>
                    <textarea cols="80" rows="5" id="txtAddress" placeholder="Current Address" class="form-control" value="address" required>  
                    </textarea>
                    <span id="addressCheck" class="text-danger">The Address is Required....</span>
            </div>
            <div class="form-group">
              <label for="email"><h5>Email:</h5></label>
              <input type="text" id="emailid" class="form-control" placeholder="Enter Email" name="email" required>
              <span id="emailvalid"
              class="text-danger">
           Your email must be a valid email
              </span>
            </div>

            <div class="form-group">
              <label for="psw"><h5>Password:</h5></label>
              <input type="password" id="txtpassword" class="form-control" placeholder="Enter Password" name="psw" required>
              <span id="PasswordCheck" class="text-danger">The Password is Required....</span>
            </div>

            <div class="form-group">
              <label for="psw-repeat"><h5>Repeat Password:</h5></label>
              <input type="password" id="txtcpassword" class="form-control" placeholder="Repeat Password" name="psw-repeat" required>
              <span id="ConPasswordCheck" class="text-danger">The ConfirmPassword is Required....</span>
            </div>

            <div class="form-group form-check">
              <input type="checkbox" class="form-check-input" checked="checked" name="remember">
              <label class="form-check-label" for="remember">Remember me</label>
            </div>

            <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>

            <div class="clearfix">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="button" id="add-userdata-save-link" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>
  <!-- Bootstrap JS and Popper.js -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script data-require="jquery.mobile@1.4.0" data-semver="1.4.0" src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
    <!-- Include SweetAlert CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/sweetalert2@9">

<!-- Include SweetAlert JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<script>
$(document).ready(function () {  
  var indexValue;   
    $("#HobbiesCheck").show();
     // Validate Firstname
     $("#NameCheck").hide();
     let firstnameError = true;           
     const name = document.getElementById("txtfname");
     //blur:- which occurs when the input field loses focus (i.e. the user clicks away from it.)
     name.addEventListener("blur", function () {
         validateUsername();
     });
     // // Validate Lastname
      $("#LastNameCheck").hide();
     let lastnameError = true;
     const lname = document.getElementById("txtlname");
     //blur:- which occurs when the input field loses focus (i.e. the user clicks away from it.) blur opposite focus
     lname.addEventListener("blur", function () {
         validateLastname();
     });
    // // Validate Address
    $("#addressCheck").hide();
     let AddressError = true;
     const address = document.getElementById("txtAddress");
     address.addEventListener("blur", function () {
         validateAddress()
     });
     // // Validate Password
     $("#PasswordCheck").hide();
     let passwordError = true;
     const password = document.getElementById("txtpassword");
     password.addEventListener("blur", function () {
         validatePassword()
     });
     // // Validate ConformPassword     
     $("#ConPasswordCheck").hide();
     let conpasswordError = true;
     const conpassword = document.getElementById("txtcpassword");
     conpassword.addEventListener("blur", function () {
         validateConfirmPassword()
     });
       // // Validate EmailF
   $("#emailvalid").hide();
    let emailError = true;    
     const email = document.getElementById("emailid");
     email.addEventListener("blur", function () {        
        validateEmail()
     });
     //validiate Hobbies      
        let HobbiesError = true;
        $("input[name='hobbies']").on("change", function () {
            validateHobbies();
        });
     // Validate Function for Firstname
     function validateUsername() {
         let firstnameValue = $("#txtfname").val();
         if (firstnameValue.length == "") {
             $("#NameCheck").show();
             firstnameError = false;
             return false;
         } else if (firstnameValue.length < 3 || firstnameValue.length > 10) {
             $("#NameCheck").show();
             $("#NameCheck").html("**length of firstname must be between 3 and 10");
             firstnameError = false;
             return false;
         } else {
             $("#NameCheck").hide(); 
             firstnameError = true;
             return true; 
         }
     }
      // Validate Function for Lastname
        function validateLastname() {
            let lastnameValue = $("#txtlname").val();
            if (lastnameValue.length == "") {
                $("#LastNameCheck").show();
                lastnameError = false;
                return false;
            } else if (lastnameValue.length < 3 || lastnameValue.length > 10) {
                $("#LastNameCheck").show();
                $("#LastNameCheck").html("**length of lastname must be between 3 and 10");
                lastnameError = false;
                return false;
            } else {
                $("#LastNameCheck").hide();
                lastnameError = true;
                return true;
            }
        }
        function validateAddress() {
          let AddressValue = $("#txtAddress").val();
          if (AddressValue === null || AddressValue.trim() === '') {             
              $("#addressCheck").show();
              AddressError = false;
              return false;
           }
           else if (AddressValue.length < 3 || AddressValue.length > 50) {            
              $("#addressCheck").show();              
              $("#addressCheck").html("**length of Address must be between 3 and 50");
              AddressError = false;
              return false;
          } 
          else {
              $("#addressCheck").hide();
              AddressError = true;
              return true;
          }
      }
          // Validate Email
          function validateEmail() {
            let EmailValue = $("#emailid").val();            
            if (EmailValue.length == '') {
                $("#emailvalid").show();                
                emailError = false;
                return false;
            } else if (!EmailValue.match(/^([_\-\.0-9a-zA-Z]+)@([_\-\.0-9a-zA-Z]+)\.([a-zA-Z]){2,7}$/)) {
                $("#emailvalid").show();
                $("#emailvalid").html("Email is not in valid format.");
                emailError = false;
                return false;
            } else {                
                $("#emailvalid").hide();
                emailError = true;
                return true;
            }            
        }
          function validateHobbies() {
            let selectedHobbies = $("input[name='hobbies']:checked");            
            if (selectedHobbies.length < 2 || selectedHobbies.length === 0) {
                
                $("#HobbiesCheck").show();
                HobbiesError = false;
                return false;
            } else {
                $("#HobbiesCheck").hide();  
                HobbiesError = true;  
                return true;            
            }
        }
    function validatePassword() {
      let passwordValue = $("#txtpassword").val();
      if (passwordValue.length == "") {
          $("#PasswordCheck").show();
          passwordError = false;
          return false;
      }else if (passwordValue.length < 3 || passwordValue.length > 20) {
        $("#PasswordCheck").show();
        $("#PasswordCheck").html("**length of your password must be between 3 and 20");
        $("#PasswordCheck").css("color", "red");
        passwordError = false;
        return false;
    } else if (passwordValue.search(/[a-z]/i) < 0 && passwordValue.search(/[A-Z]/) < 0) {
        $("#PasswordCheck").show();
        $("#PasswordCheck").html("Your password must contain at least one uppercase and one lowercase.");
    } else if (passwordValue.search(/[0-9]/) < 0) {
        $("#PasswordCheck").show();
        $("#PasswordCheck").html("Your password must contain at least one digit.");
        passwordError = false;
        return false;
    } else if (!passwordValue.match(/[~`!@#$%^&*()--+={}[\]|\\:;"'<>,.?/_₹]/)) {
        $("#PasswordCheck").show();
        $("#PasswordCheck").html("Your password must contain at least one special character.");
        passwordError = false;
        return false;
    } else {
        $("#PasswordCheck").hide();
        passwordError = true;
        return true;
    }
  }
  function validateConfirmPassword() 
  {
      let confirmPasswordValue = $("#txtcpassword").val();
      let passwordValue = $("#txtpassword").val();
      if (confirmPasswordValue.length == "") {
          $("#ConPasswordCheck").show();
          passwordError = false;
          return false;
      }    
      else if (passwordValue != confirmPasswordValue) {
          $("#ConPasswordCheck").show();
          $("#ConPasswordCheck").html("**Password didn't Match, Please Enter the Correct Password...");
          $("#ConPasswordCheck").css("color", "red");
          conpasswordError = false;
          return false;
      } else {
          $("#ConPasswordCheck").hide();
          conpasswordError = true;
          return true;
      }
  }   
          function validateForm() 
          {
              // Perform validation checks                
                validateUsername();
                validateLastname();
                validateHobbies();
                validateEmail();
                validateAddress();
                validatePassword();
                validateConfirmPassword();    
                if (                                        
                    firstnameError == true &&                    
                    lastnameError == true &&
                    emailError == true &&
                    HobbiesError == true &&
                    AddressError == true &&
                    passwordError == true &&
                    conpasswordError == true
                ) {             
                   return true;
                } else {                  
                    return false;               
                }
          }
            $(document).on("click", "#editbtn", function () 
            {
                  indexValue = $(this).data("val");                
            });
           
            $("#add-userdata-save-link").click(function (e) 
            {
              //if the button type is submit then we have write  e.preventDefault() becuase form will submit two time and alert will not show.
              // e.preventDefault();
              var formvalidation = validateForm();       
                // Check if the button text is "Edit"
                var isEditOperation = $(this).text() === "Edit";
                  if (formvalidation == true) 
                  {
                          var FirstName = $('#txtfname').val();
                          var LastName = $('#txtlname').val();    
                          var Email = $('#emailid').val();
                          var Gender = $('input[name="gender"]:checked').val();
                          let selectedHobbies = $("input[name='hobbies']:checked");
                          let selectedValues = selectedHobbies.map(function() {
                              return $(this).val();
                          }).get();
                          var address = $('#txtAddress').val();
                          var Password = $('#txtpassword').val();
                          var ConformPassword = $('#txtcpassword').val();   
                          var existingUserDetails = $.cookie("UserDetails");

                      var registration = {
                              FirstName: FirstName,            
                              LastName: LastName,
                              selectedHobbies: selectedValues,
                              Email: Email,
                              Gender: Gender,
                              address: address,
                              Password: Password,
                              ConformPassword:ConformPassword
                          };
                          registration = JSON.stringify(registration);
                          ExistingDataObject = [];
                          if (isEditOperation)
                           {                      
                                    // Update the existing user data
                                    if (existingUserDetails !== null && typeof existingUserDetails !== "undefined")
                                    {
                                          ExistingDataObject = JSON.parse(existingUserDetails);
                                          ExistingDataObject[indexValue] = registration;
                                          $.cookie("UserDetails", JSON.stringify(ExistingDataObject), { expires: 365 });
                                          
                                          Swal.fire({
                                              title: "Success",
                                              text: "Data successfully updated in the cookie",
                                              icon: "success",
                                              timer: 1500,
                                              showConfirmButton: false
                                          });
                                          $('#signupModal').modal('hide');
                                          setTimeout(function () {
                                              location.reload();
                                          }, 1500);
                                    } else
                                    {
                                        Swal.fire({
                                            title: "Error",
                                            text: "UserDetails cookie not found for edit operation",
                                            icon: "error",
                                            timer: 1500,
                                            showConfirmButton: false
                                        });
                                    }
                          } else
                           {
                              // New data entry
                              if (existingUserDetails !== null && typeof existingUserDetails !== "undefined")
                               {
                                  ExistingDataObject = JSON.parse(existingUserDetails);
                                  
                               }              
                                  ExistingDataObject.push(registration);              
                                  $.cookie("UserDetails", JSON.stringify(ExistingDataObject), { expires: 365 });
                                  Swal.fire({
                                      title: "Success",
                                      text: "Data successfully saved in the cookie",
                                      icon: "success",
                                      timer: 1500,
                                      showConfirmButton: false
                                  });
                                  $('#signupModal').modal('hide');
                                  
                                setTimeout(function () {
                                    location.reload();
                                }, 1500);
                            }
               } else
                {
                  e.preventDefault();
                }                                
          });
                renderTable();
            function renderTable() {      
                       
            var existingUserDetails = $.cookie("UserDetails");                
                // Check if the cookie exists
                if (existingUserDetails) {                                            
                    var mydata = existingUserDetails  ;
                    var sorteddata = JSON.parse(mydata);                                                        
                    // Get the table and insert a new row at the end 
                    let table = document.getElementById("TableData");
                    // Loop through the sorteddata array
                    sorteddata.forEach(function (user, index) {
                      var userDetails = JSON.parse(user);
                      console.log("userDetails:", userDetails);                 
                        // Insert a new row at the end
                        let newRow = table.insertRow(table.rows.length);
                        // Insert data into cells of the new row
                        newRow.insertCell(0).innerHTML = index + 1;
                        newRow.insertCell(1).innerHTML = userDetails.FirstName;
                        newRow.insertCell(2).innerHTML = userDetails.LastName;
                        newRow.insertCell(3).innerHTML = userDetails.Gender; // Display hobbies as a comma-separated string
                        newRow.insertCell(4).innerHTML =  userDetails.selectedHobbies.join(", ");                        
                        newRow.insertCell(5).innerHTML = userDetails.address;
                        newRow.insertCell(6).innerHTML = userDetails.Email;
                        newRow.insertCell(7).innerHTML = userDetails.Password;
                        newRow.insertCell(8).innerHTML = `<button id="editbtn" data-val="${index}" data-toggle="modal" data-target="#signupModal" class="btn btn-success" onclick="editData(this)">Edit</button>`
                        newRow.insertCell(9).innerHTML = `<button id="deletebtn" data-val="${index}" class="btn btn-danger" onclick="deleteData(this)">Delete</button>`; 
                        $("#TableData td:nth-child(8)").css("display", "none");
                      });
                } else {
                    console.log("UserDetails cookie not found");
                }
              }
                });
                function editData(button) 
                {                  
                hideValidationMessages();                
                 indexValue = $(button).data("val");                
                console.log("indexValue:-" + indexValue);
                $("#add-userdata-save-link").text("Edit");
                var modalTitle =  "Update User";
                    $("#signupModalLabel").text(modalTitle);
                        // Traverse the DOM to get the row containing the clicked button
                        var row = button.closest("tr");
                        // Get data from the cells of the selected row
                        var id = row.cells[0].innerHTML;
                        var firstName = row.cells[1].innerHTML;
                        var lastName = row.cells[2].innerHTML;
                        var gender = row.cells[3].innerHTML;
                        var hobbies = row.cells[4].innerHTML;
                        var address = row.cells[5].innerHTML;
                        var email = row.cells[6].innerHTML;
                        var password = row.cells[7].innerHTML;
                        $('input[name="hobbies"]').each(function() {
                        var hobbyValue = $(this).val();
                        $(this).prop('checked', hobbies.includes(hobbyValue));
                    });
                        $('#txtfname').val(firstName);    
                        $('#txtlname').val(lastName);                   
                        $('input[name="hobbies"]').each(function() {
                            var hobbyValue = $(this).val();
                            $(this).prop('checked', hobbies.includes(hobbyValue));
                        });
                        $('input[name="gender"]').each(function() {
                            var genderValue = $(this).val();
                            $(this).prop('checked', gender === genderValue);
                        });
                        $('#txtAddress').val(address);
                        $('#emailid').val(email);
                        $('#txtpassword').val(password);
                        $('#txtcpassword').val(password);
                                                
                        console.log("Edit clicked for row with ID: " + id);
                        console.log("FirstName: " + firstName);
                        console.log("LastName: " + lastName);
                        console.log("Gender: " + gender);
                        console.log("Hobbies: " + hobbies);
                        console.log("Address: " + address);
                        console.log("Email: " + email);
                        console.log("Password: " + password);
                    }                   
                      function deleteData(button) 
                      {
                        var indexValue = $(button).data("val");
                        var existingUserDetails = $.cookie("UserDetails");
                        if (existingUserDetails) {
                            existingUserDetails = JSON.parse(existingUserDetails);
                        // Check if the index is valid
                        if (indexValue !== undefined && indexValue >= 0 && indexValue < existingUserDetails.length)
                         {
                            // Show a confirmation dialog using SweetAlert
                            Swal.fire({
                                title: "Alert",
                                text: "Are you sure you want to delete this user?",
                                icon: "warning",
                                showCancelButton: true,
                                confirmButtonText: "Delete",
                                cancelButtonText: "Cancel"
                            }).then((result) => {
                                if (result.isConfirmed)
                                 {
                                    // Remove the user data at the specified index
                                    existingUserDetails.splice(indexValue, 1);
                                    // Update the cookie with the modified data
                                    $.cookie("UserDetails", JSON.stringify(existingUserDetails), { expires: 365 });
                                    // Re-render the table with the updated data
                                    location.reload();
                                    Swal.fire("Deleted!", "User has been deleted.", "success");
                                  }
                                    });
                                  } else
                                  {
                                    Swal.fire("Error", "Invalid index for deletion", "error");
                                  }
                            } else {
                                Swal.fire("Error", "UserDetails cookie not found", "error");
                            }
                      } 
                    function ClearInput() 
                    {
                      var hobbies = ["Painting"];
                      // Iterate over each checkbox and check it if the value is in the hobbies array
                      $('input[name="hobbies"]').each(function() {
                          var hobbyValue = $(this).val();
                          $(this).prop('checked', hobbies.includes(hobbyValue));
                      });
                        $('#txtfname').val('');
                        $('#txtlname').val('');
                        $('#txtfname').val('');
                        $('#txtAddress').val('');
                        $('#emailid').val('');
                        $('#txtpassword').val('');
                        $('#txtcpassword').val('');
                        hideValidationMessages();
                    }
                    function hideValidationMessages() 
                    {
                        $("#NameCheck").hide();
                        $("#LastNameCheck").hide();
                        $("#addressCheck").hide();
                        $("#PasswordCheck").hide();
                        $("#ConPasswordCheck").hide();
                        $("#emailvalid").hide();
                        $("#HobbiesCheck").hide();
                    }
                    $('#signupModal').on('hidden.bs.modal', function (e) {
                      ClearInput();
                    });
</script>
</body>

</html>
